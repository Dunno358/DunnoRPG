{% extends 'master.html' %}
{% load filters %}

{% block content %}
{% include 'top_bar.html' %}
{% include 'dunnorpg/messages.html' %}

<div id='pop-window' class='d-none position-fixed container-fluid mt-5'>
    <div class='row bg-dark c-gold rounded border border-warning mt-5 ms-5 me-5'>

        <div class='row text-center ms-1'>
            <div class='col mt-4'>
                <h5 id='window-action-text-top' class='m-1'></h5>
            </div>
        </div>

        <div class='row text-center ms-1'>
            <div class='col mt-4 mb-2'>
                <h5 id='window-action-text-center' class='m-1'>Action</h5>
            </div>
        </div>

        <div class='row text-end'>
            <div class='col'>
                <a href='https://g.co/kgs/iznN81' id='window-footer-text' class='c-gold text-decoration-underline'></a>
            </div>
        </div>

        <div class='row text-center ms-1'>
            <div class='col m-2'>
                <a onclick='this.parentNode.parentNode.parentNode.parentNode.classList.add("d-none")' class='btn btn-lg btn-outline-danger'>Back</a>
            </div>
        </div>

    </div>
</div>

<div class="container-fluid">        
    <div class="header-bg bg-dark border-top border-bottom border-primary mt-1 row">
        <button id='Stats'  onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            Stats</button>

        <button id='Equipment' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-primary border border-primary rounded'>
            Equipment</button>

        <button id='Skills' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            Skills</button>
        
        <button id='Effects' onclick="show_or_hideByName(this)" class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            Effects</button>
    </div>
</div>

<div class="container-fluid row">
    {% for value in chosen_character %}

    <div class='d-none'>
        <p id='effects-accuraccy'>{{ value.name|getEffectsBonus:"accuraccy" }}</p>
        <p id='effects-attack'>{{ value.name|getEffectsBonus:"attack" }}</p>
        <p id='effects-parry'>{{ value.name|getEffectsBonus:"parry" }}</p>
        <p id='effects-dodge'>{{ value.name|getEffectsBonus:"dodge" }}</p>
        <p id='weapon-weight-mod'>0</p>
    </div>

    <div name='Stats' class="row card-body d-none text-center mt-4 c-gold border border-warning bg-dark rounded position-fixed">
        <h3>Stats</h3>
        <p name='stat'><span class="text-white-50">INT:</span> <span id='stat-INT'>{{ value.INT }}</span> (<span id='stat-INT-mod'>{{ value|getMod:"INT" }}</span>)</p>
        <p name='stat'><span class="text-white-50">SIŁ:</span> <span id='stat-SIŁ'>{{ value.SIŁ }}</span> (<span id='stat-SIŁ-mod'>{{ value|getMod:"SIŁ" }}</span>)</p>
        <p name='stat'><span class="text-white-50">ZRE:</span> <span id='stat-ZRE'>{{ value.ZRE }}</span> (<span id='stat-ZRE-mod'>{{ value|getMod:"ZRE" }}</span>)</p>
        <p name='stat'><span class="text-white-50">CHAR:</span> <span id='stat-CHAR'>{{ value.CHAR }}</span> (<span id='stat-CHAR-mod'>{{ value|getMod:"CHAR" }}</span>)</p>
        <p name='stat'><span class="text-white-50">CEL:</span> <span id='stat-CEL'>{{ value.CEL }}</span> (<span id='stat-CEL-mod'>{{ value|getMod:"CEL" }}</span>)</p>
    </div>

    <div name='Equipment' style='' class="row text-center ms-3 mt-1 card-body c-gold border border-warning bg-dark rounded">
        <p id='char-name' name='{{ value.id }}' class="text-center fw-bold">
            {{ value.name }}
            {% if value.chosen_class %}| 
            <a 
            href='https://docs.google.com/document/d/1A-AM1SF78bhQ0blRxf06kb7VQ9WMYVeSN4VhOn3j53g/edit?usp=sharing'
            target='_blank' class='c-gold fst-italic'
            >
                {{ value.chosen_class }}
            </a>
            {% endif %}
        </p>

        <div class='row'>
            <p class='col'>
                <span class="text-white-50">Armor:</span> 
                <span id='armor'>{{ value.name|getArmor }}</span>; <span id='armor-weight'>{{ value.name|getArmorWeight }}</span>kg (-<span id='armor-mod'></span> ZRE)</p>
            <p class='col'>
                <span class="text-white-50">Health:</span> 
                <input type='number' min="1" max="25" id='hp-val' class='c-gold text-center bg-dark border-0' style='width: 6vw' value='{{ value.HP }}'>/{{ value.fullHP }}
                <a onclick="makeChangeToRequest('hp-val','Character','hp')"
                class='btn btn-sm btn-success ms-3 rounded text-black'>Change</a>
            </p>
        </div>

        <div name='head' class='row mt-2'><hr />
            <div class='col'><p><span class="text-white-50">Helmet: </span>
                {% if helmet != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("helmet-swap")'></span> 

                    <a class='{{ helmet.name|getItemRarity }} fw-bold' href='/dunnorpg/items/{{ helmet.name|getDescId }}'>
                    {{ helmet.name }}</a>

                    <span class='{{ helmet.name|getItemRarity }}'><b>[ {{ helmet.name|getItemArmor }}; {{ helmet.name|getItemWeight }}kg
                    {% if helmet.name|getSkill %};
                        <span onclick="showSkill(this)" class='fw-normal' title="{{ helmet.name|getSkill }}">
                            Check skill
                        </span>
                    {% endif %}]</b></span>
                    
                    ({{ helmet.durability }}/{{ helmet.name|getMaxDurability }})   
                    <a href='move_eq-{{ helmet.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>
                    
                    <div id='helmet-swap' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_helmets %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="swapItem('{{ helmet.id }}', 'helmet-swap')" class='btn btn-sm btn-success'>OK</a>
                    </div>

                {% else %}
                    <span class='text-info fa fa-plus' onclick='show_or_hideById("helmet-add")'></span> 

                    <div id='helmet-add' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_helmets %}
                                <option id='{{ item.id }}' value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="wearItem('Helmet', 'helmet-add')" class='btn btn-sm btn-success'>OK</a>
                    </div>     
                      
                {% endif %}
            </p></div>
        </div>

        <div name='torso' class='row mt-2'><hr />
            <div class='col'><p><span class="text-white-50">Torso: </span> 

                {% if torso != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("torso-swap")'></span> 

                    <a class='{{ torso.name|getItemRarity }} fw-bold' href='/dunnorpg/items/{{ torso.name|getDescId }}'>
                        {{ torso.name }}</a>
    
                        <span class='{{ torso.name|getItemRarity }}'><b>[ {{ torso.name|getItemArmor }}; {{ torso.name|getItemWeight }}kg
                        {% if torso.name|getSkill %};
                            <span onclick="showSkill(this)" class='fw-normal' title="{{ torso.name|getSkill }}">
                                Check skill
                            </span>
                        {% endif %}]</b></span>
                        
                    ({{ torso.durability }}/{{ torso.name|getMaxDurability }})</a>   
                    <a href='move_eq-{{ torso.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                    <div id='torso-swap' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_torsos %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="swapItem('{{ torso.id }}', 'torso-swap')" class='btn btn-sm btn-success'>OK</a>
                    </div> 

                {% else %}              
                <span class='text-info fa fa-plus' onclick='show_or_hideById("torso-add")'></span> 

                <div id='torso-add' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_torsos %}
                            <option id='{{ item.id }}' value='{{ item.name }}'>
                                {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                            </option>
                        {% endfor %}
                    </select>
                    <a onclick="wearItem('Torso', 'torso-add')" class='btn btn-sm btn-success'>OK</a>
                </div> 

                {% endif %}
            </p></div>
        </div>

        <div name='hands' class='row mt-2'><hr />
            <div name='hand-left' class='row'><p name="LeftHand">
                <span class="text-white-50">LeftHand: </span>
                    {% if leftItem != None %}
                        <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("left-swap")'></span> 
                        (<span id='l_bonus'>{{ value.name|isPreffereOrUnliked:leftItem.name }}</span>)

                        <a class='{{ leftItem.name|getItemRarity }} fw-bold'  href='/dunnorpg/items/{{ leftItem.name|getDescId }}'>
                            <span name="{{ leftItem.name|getItemType }}" id='l_weapon'>{{ leftItem.name }}</span>
                        </a>
                        <span class='fw-bold {{ leftItem.name|getItemRarity }}'>
                            {% if leftItem.name|isShield %}
                            [ <span id='l_block'>{{ leftItem.name|getItemBlock }}</span>
                            ; <span id='l-weight'>{{ leftItem.name|getItemWeight }}</span>kg
                            {% else %}
                            [ 1K<span id='l_dmg'>{{ leftItem.name|getItemBonus }}</span>, <span id='l_ap'>{{ leftItem.name|getItemAP }}</span>
                            AP; <span id='l-weight'>{{ leftItem.name|getItemWeight }}</span>kg
                            {% endif %}

                            {% if leftItem.name|getSkill %};
                                <span onclick="showSkill(this)" class='fw-normal' title="{{ leftItem.name|getSkill }}">
                                    Check skill
                                </span>
                            {% endif %}]
                        </span>
                        
                        <span class='c-gold' id='s_dur'>({{ leftItem.durability }}/{{ leftItem.name|getMaxDurability }})</span>   
                        <a class='text-danger h6' href='/dunnorpg/makerequest/{{ value.id }};CharItems;CharItems;{{ leftItem.id }};0;durability;downgrade-1;character_detail'>-1</a>
                        <a href='move_eq-{{ leftItem.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                        <div id='left-swap' class='d-none'> 
                            <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                                {% for item in eq_weapons %}
                                    <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                        {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                    </option>
                                {% endfor %}
                            </select>
                            <a onclick="swapItem('{{ leftItem.id }}', 'left-swap')" class='btn btn-sm btn-success'>OK</a>
                        </div>

                    {% else %}
                        (<span id='l_bonus'>Empty</span>)
                        <span class='text-info fa fa-plus' onclick='show_or_hideById("left-add")'></span>    

                        <div id='left-add' class='d-none'> 
                            <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                                {% for item in eq_weapons %}
                                    <option id='{{ item.id }}' value='{{ item.name }}'>
                                        {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                    </option>
                                {% endfor %}
                            </select>
                            <a onclick="wearItem('Left', 'left-add')" class='btn btn-sm btn-success'>OK</a>
                        </div> 
                        
                    {% endif %}
                    </p>
            </div>

            <div class='col'></div>

            <div name='hand-right' class='row text-center'><hr />
                <p name="RightHand">
                <span class="text-white-50">RightHand: </span>
                {% if rightItem.name != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("right-swap")'></span> 
                    (<span id='r_bonus'>{{ value.name|isPreffereOrUnliked:rightItem.name }}</span>)
                    
                    <a class='{{ rightItem.name|getItemRarity }} fw-bold'  href='/dunnorpg/items/{{ rightItem.name|getDescId }}'>
                        <span name="{{ rightItem.name|getItemType }}" id='r_weapon'>{{ rightItem.name }}</span>
                    </a>
                    <span class='fw-bold {{ rightItem.name|getItemRarity }}'>
                        {% if rightItem.name|isShield %}
                            [ <span id='r_block'>{{ rightItem.name|getItemBlock }}</span>
                            ; <span id='r-weight'>{{ rightItem.name|getItemWeight }}</span>kg
                        {% else %}
                            [ 1K<span id='r_dmg'>{{ rightItem.name|getItemBonus }}</span>, <span id='r_ap'>{{ rightItem.name|getItemAP }}</span>
                            AP; <span id='r-weight'>{{ rightItem.name|getItemWeight }}</span>kg
                        {% endif %}

                        {% if rightItem.name|getSkill %};
                            <span onclick="showSkill(this)" class='fw-normal' title="{{ rightItem.name|getSkill }}">
                                Check skill
                            </span>
                        {% endif %}]
                    </span>

                <span class='c-gold' id='s_dur'>({{ rightItem.durability }}/{{ rightItem.name|getMaxDurability }})</span>   
                <a class='text-danger h6' href='/dunnorpg/makerequest/{{ value.id }};CharItems;CharItems;{{ rightItem.id }};0;durability;downgrade-1;character_detail'>-1</a>
                <a href='move_eq-{{ rightItem.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                <div id='right-swap' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_weapons %}
                            <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                            </option>
                        {% endfor %}
                    </select>
                    <a onclick="swapItem('{{ rightItem.id }}', 'right-swap')" class='btn btn-sm btn-success'>OK</a>
                </div>

                {% else %}

                    {% if leftItem.name|isDualHanded %}
                        <span id='r_weapon' class='c-gold'>Above weapon is two-handed</span>
                        <span id='r_bonus'></span>
                        <span id='r_dmg'></span>
                        <span id='r_ap'></span>
                    {% else %}
                        (<span id='r_bonus'>Empty</span>) 
                        <span class='text-info fa fa-plus' onclick='show_or_hideById("right-add")'></span>   

                        <div id='right-add' class='d-none'> 
                            <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                                {% for item in eq_weapons %}
                                    <option id='{{ item.id }}' value='{{ item.name }}'>
                                        {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                    </option>
                                {% endfor %}
                            </select>
                            <a onclick="wearItem('Right', 'right-add')" class='btn btn-sm btn-success'>OK</a>
                        </div> 

                    {% endif %}
                {% endif %}
                    </p>
            </div>
        </div>

        <div name='side' class='row mt-2'><hr />
            <div class='col'><p><span class="text-white-50">Side: </span>

            {% if sideItem != None %}
                <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("side-swap")'></span> 

                <a class='{{ sideItem.name|getItemRarity }} fw-bold'  href='/dunnorpg/items/{{ sideItem.name|getDescId }}'>
                    {{ sideItem.name }}
                </a>
                <span class='{{ sideItem.name|getItemRarity }} fw-bold'>
                    [ {{ sideItem.name|getItemStatByName }}; {{ sideItem.name|getItemWeight }}kg
                    {% if sideItem.name|getSkill %};
                        <span onclick='showSkill(this)' class='fw-normal' title="{{ sideItem.name|getSkill }}">
                            Check skill
                        </span>
                    {% endif %}]
                </span>

                <span class='c-gold' id='s_dur'>({{ sideItem.durability }}/{{ sideItem.name|getMaxDurability }})</span>   
                <a class='text-danger h6' href='/dunnorpg/makerequest/{{ value.id }};CharItems;CharItems;{{ sideItem.id }};0;durability;downgrade-1;character_detail'>-1</a>
                <a href='move_eq-{{ sideItem.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                <div id='side-swap' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_weapons %}
                            <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                            </option>
                        {% endfor %}
                    </select>
                    <a onclick="swapItem('{{ sideItem.id }}', 'side-swap')" class='btn btn-sm btn-success'>OK</a>
                </div>

            {% else %}

            <span class='text-info fa fa-plus' onclick='show_or_hideById("side-add")'></span> 
               
            <div id='side-add' class='d-none'> 
                <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                    {% for item in eq_weapons %}
                        <option id='{{ item.id }}' value='{{ item.name }}'>
                            {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                        </option>
                    {% endfor %}
                </select>
                <a onclick="wearItem('Side', 'side-add')" class='btn btn-sm btn-success'>OK</a>
            </div> 
            {% endif %}

            </p></div>
            
        </div>

        <div name='boots' class='row mt-2'><hr />
            <div class='col'><p><span class="text-white-50">Boots: </span> 

                {% if boots != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("boots-swap")'></span> 

                    <a class='{{ boots.name|getItemRarity }} fw-bold' href='/dunnorpg/items/{{ boots.name|getDescId }}'>
                        {{ boots.name }}</a>
    
                        <span class='{{ boots.name|getItemRarity }}'><b>[ {{ boots.name|getItemArmor }}; {{ boots.name|getItemWeight }}kg
                        {% if boots.name|getSkill %};
                            <span onclick="showSkill(this)" class='fw-normal' title="{{ boots.name|getSkill }}">
                                Check skill
                            </span>
                        {% endif %}]</b></span>
                        
                    ({{ boots.durability }}/{{ boots.name|getMaxDurability }}) 
                    <a href='move_eq-{{ boots.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                    <div id='boots-swap' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_boots %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="swapItem('{{ boots.id }}', 'boots-swap')" class='btn btn-sm btn-success'>OK</a>
                    </div>  

                {% else %}

                <span class='text-info fa fa-plus' onclick='show_or_hideById("boots-add")'></span>   

                <div id='boots-add' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_boots %}
                            <option id='{{ item.id }}' value='{{ item.name }}'>
                                {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                            </option>
                        {% endfor %}
                    </select>
                    <a onclick="wearItem('Boots', 'boots-add')" class='btn btn-sm btn-success'>OK</a>
                </div> 

                {% endif %}
            </p></div>
        </div>

        <div name='gloves' class='row mt-2'><hr />
            <div class='col'><p><span class="text-white-50">Gloves: </span> 

                {% if gloves != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("gloves-swap")'></span> 

                    <a class='{{ gloves.name|getItemRarity }} fw-bold' href='/dunnorpg/items/{{ gloves.name|getDescId }}'>
                        {{ gloves.name }}</a>
    
                        <span class='{{ gloves.name|getItemRarity }}'><b>[ {{ gloves.name|getItemArmor }}; {{ gloves.name|getItemWeight }}kg
                        {% if gloves.name|getSkill %};
                            <span onclick="showSkill(this)" class='fw-normal' title="{{ gloves.name|getSkill }}">
                                Check skill
                            </span>
                        {% endif %}]</b></span>
                        
                    ({{ gloves.durability }}/{{ gloves.name|getMaxDurability }})
                    <a href='move_eq-{{ gloves.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                    <div id='gloves-swap' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_gloves %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="swapItem('{{ gloves.id }}', 'gloves-swap')" class='btn btn-sm btn-success'>OK</a>
                    </div>

                {% else %}
                <span class='text-info fa fa-plus' onclick='show_or_hideById("gloves-add")'></span> 

                <div id='gloves-add' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_gloves %}
                            <option id='{{ item.id }}' value='{{ item.name }}'>
                                {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                            </option>
                        {% endfor %}
                    </select>
                    <a onclick="wearItem('Gloves', 'gloves-add')" class='btn btn-sm btn-success'>OK</a>
                </div> 

                {% endif %}
            </p></div>
        </div>

        <div name='amulet' class='row mt-2'><hr />
            <p class='col'><span class="text-white-50">Amulet: </span> 

                {% if amulet != None %}
                    <span class='text-info fa fa-exchange-alt' onclick='show_or_hideById("amulet-swap")'></span> 

                    <a class='{{ amulet.name|getItemRarity }} fw-bold' href='/dunnorpg/items/{{ amulet.name|getDescId }}'>
                    {{ amulet.name }}</a>  
                    <b class="{{ amulet.name|getItemRarity }}">
                        [ {{ amulet.name|getItemWeight }}kg
                        {% if amulet.name|getSkill %};
                            <span onlick='showSkill(this)' class="fw-normal" title="{{ amulet.name|getSkill }}">
                                {{ amulet.name|getSkill }}
                            </span>
                        {% endif %}]
                    </b>
                    <a href='move_eq-{{ amulet.id }}' class='fa fa-arrow-right text-success text-decoration-none'>EQ</a>

                    <div id='amulet-swap' class='d-none'> 
                        <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                            {% for item in eq_amulets %}
                                <option id='{{ item.id }}' name={{ item.durability }} value='{{ item.name }}'>
                                    {{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})
                                </option>
                            {% endfor %}
                        </select>
                        <a onclick="swapItem('{{ amulet.id }}', 'amulet-swap')" class='btn btn-sm btn-success'>OK</a>
                    </div>

                {% else %}
                <span class='text-info fa fa-plus' onclick='show_or_hideById("amulet-add")'></span>  

                <div id='amulet-add' class='d-none'> 
                    <select class='w-50 ms-2 text-center border border-warning bg-dark text-white-50 rounded'>
                        {% for item in eq_amulets %}
                            <option id='{{ item.id }}' value='{{ item.name }}'>{{ item.name }} ({{ item.durability }}/{{ item.name|getMaxDurability }})</option>
                        {% endfor %}
                    </select>
                    <a onclick="wearItem('Amulet', 'amulet-add')" class='btn btn-sm btn-success'>OK</a>
                </div> 

                {% endif %}
            </p>
        </div>

        <div class='row'><hr />
            <p class='col' title='{{ race_desc }}'><span class="text-white-50">Race:</span> {{ value.race }} ({{ value.size }})</p>
                <p class='col'><span class="text-white-50">Coins:</span> {{ value.coins }}</p>
            </p>
        </div>

    </div>    
    
        <div name='Effects' class="row position-absolute d-none rounded container col card-body c-gold border border-warning bg-dark mt-4">
            <p class="text-center fw-bold">Effects: </p>
            <ul>
            {% for effect in value|getCharacterEffects %}
            <li onclick="show_or_hideById(this.attributes['name'].value)" name='ef{{ effect.id }}' class='fw-bold fst-italic'>
                {{ effect.name }} (+{{ effect.bonus }}) 
                {% if effect.time != 100 %}| Time left: {{ effect.time }}{% else %}| Item{% endif %}
            </li>
            <p id='ef{{ effect.id }}' class='d-none'>{{ effect.name|getEffectDesc }}</p>
            {% endfor %}
            </ul>
        </div>
    

    <div name='Skills' style='' class="row position-absolute d-none rounded container col card-body c-gold border border-warning bg-dark">
        <p class="text-center fw-bold">Skills: </p>
        <ul class=''>
        {% for skill in skills %}
            <li>
                <a class='c-gold fst-italic' href='/dunnorpg/skills/{{ skill.original_id }}'>{{ skill.skill }} [{{ skill.level }}]</a>
                <button onclick="show_block(this)" name="{{ skill.id }}" type='button' class='fst-italic ms-2 rounded-circle border border-warning btn btn-sm btn-warning btn-outline-dark c-gold'>i</button>
                <div id='{{ skill.id }}' name="desc_block" class="d-none">
                    <p class='fw-bold text-center'>{{ skill.skill }} lvl.{{ skill.level }}</p>
                    {{ skill.desc }}
                    <br>
                    [<span class='fst-italic'>{{ skill.level_desc }}</span>]
                </div>
            </li><br>
        {% endfor %}
        <ul>
    </div>
</div>

<div class='container mt-2'>
    <div class='row'>
        <div onclick='show_result_at_window("Accuraccy")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-crosshairs'> Accuraccy</span>
        </div>
        <div onclick='show_result_at_window("Parry")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-shield-alt'> Parry</span>
        </div>
        <div onclick='show_result_at_window("Attack")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fab fa-pied-piper-alt'> Attack</span>
        </div>
        <div onclick='show_result_at_window("Dodge")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-walking'> Dodge</span>
        </div>
        <div onclick='show_result_at_window("Dice")' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-dice-d20'> Dice</span>
        </div>

        <a href='/dunnorpg/items/ch{{ value.id }}' name='eq-link' class='col m-1 btn btn-dark btn-outline-warning border border-warning rounded'>
            <span class='fas fa-scroll'> Equipment</span>
        </a>
    
</div>

<div class='d-none'>
    <p id='item-skill-int'>{{ value.name|getStatFromItems:"INT" }}</p>
    <p id='item-skill-sil'>{{ value.name|getStatFromItems:"SIŁ" }}</p>
    <p id='item-skill-zre'>{{ value.name|getStatFromItems:"ZRE" }}</p>
    <p id='item-skill-char'>{{ value.name|getStatFromItems:"CHAR" }}</p>
    <p id='item-skill-cel'>{{ value.name|getStatFromItems:"CEL" }}</p>
</div>

<script>
document.getElementById('tb-characters').classList.remove('btn-outline-warning')
document.getElementById('tb-characters').classList.add('btn-outline-primary')

document.getElementById('hp-val').oninput = () => {
    document.getElementById('hp-val').setAttribute('value', document.getElementById('hp-val').value);
}

function showSkill(instance){
    if(instance.innerHTML == "Check skill"){
        instance.innerHTML = instance.title
    }
    else{
        instance.innerHTML = "Check skill"
    }
}

function makeChangeToRequest(field_id, model, field){
    field_val = document.getElementById(field_id).getAttribute('value')
    chid = document.getElementById('char-name').getAttribute('name')
    url = '/dunnorpg/makerequest/'+chid+';'+model+';'+model+';0;0;'+field+';change_to-'+field_val+';character_detail'
    window.location.replace(url)
}

function swapItem(id1, block_id){
    chid = document.getElementById('char-name').getAttribute('name')
    id2 = document.getElementById(block_id).children[0]
    id2 = id2.options[id2.selectedIndex].id
    url = window.location.href
    url = url+id1+'-'+id2
    window.location.replace(url)
}

function wearItem(place, block_id){
    chid = document.getElementById('char-name').getAttribute('name')
    it1 = document.getElementById(block_id).children[0]
    it1 = it1.options[it1.selectedIndex].id
    url = window.location.href+it1+';'+place
    window.location.replace(url)
}

function getWeaponMod(){
    try{
        l_weight = parseFloat(document.getElementById('l-weight').innerHTML)
    }catch(error){
        l_weight = 0
    }

    try{
        r_weight = parseFloat(document.getElementById('r-weight').innerHTML)
    }catch(error){
        r_weight = 0
    }

    sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
    mod = (r_weight+l_weight)-sil
    mod = parseInt(mod/2)

    document.getElementById('weapon-weight-mod').innerHTML = mod
}
getWeaponMod()

function getArmorMod(){
    armor_weight = parseInt(document.getElementById('armor-weight').innerHTML)
    mod = armor_weight/4
    mod = parseInt(mod)
    document.getElementById('armor-mod').innerHTML = mod
}
getArmorMod()

function getRandomInt(min=1,max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min) + min);
    }

function show_block(instance){
    let blocks = document.getElementsByName('desc_block')
    for (let i = 0; i < blocks.length; i++){
            if(blocks[i].id==instance.name){
                if(blocks[i].classList.contains('d-none')){
                    blocks[i].classList.remove('d-none')
                }
                else{
                    blocks[i].classList.add('d-none')
                }
            }
            else{
                blocks[i].classList.add('d-none')
            }
        }
    };

function show_or_hideByName(instance, changeColor=false){
    let element = document.getElementsByName(instance.id)[0]
    if (element.classList.contains('d-none')){
        element.classList.remove('d-none')

        instance.classList.remove('btn-outline-warning')
        instance.classList.remove('border-warning')

        instance.classList.add('btn-outline-primary')
        instance.classList.add('border-primary')
    }
    else{
        element.classList.add('d-none')

        instance.classList.remove('btn-outline-primary')
        instance.classList.remove('border-primary')

        instance.classList.add('btn-outline-warning')
        instance.classList.add('border-warning')
    }
};

function show_or_hideById(id){
    let element = document.getElementById(id)
    if (element.classList.contains('d-none')){
        element.classList.remove('d-none')
    }
    else{
        element.classList.add('d-none')
    }
};

function change_result(text, element, mods, result, additional=false){

    if(additional){
        element = document.getElementById('window-action-text-top')
    }
    else{
        element = document.getElementById('window-action-text-center')
    }

    if (element.innerHTML == text){
        element.innerHTML = result
    }
    else{
        element.innerHTML = text
    }
}

function show_result_at_window(action){
    document.getElementById('pop-window').classList.remove('d-none')


    window_action = document.getElementById('window-action-text-center')
    window_action_additional = document.getElementById('window-action-text-top')

    window_url = document.getElementById('window-footer-text')

    if(action=='Dice'){window_url.innerHTML = 'Google Dice'}
    else{window_url.innerHTML = ''}


    if(action == 'Dice')
    {
        diceRoll = getRandomInt(1,21)
        window_action.innerHTML = "<b>Dice:</b> " + diceRoll
        window_action.onclick = ''
        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''
    }

    else if (action == 'Accuraccy')
    {
        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''
        cel_effect_bonus = parseInt(document.getElementById('effects-accuraccy').innerHTML)
        cel = parseInt(document.getElementById('stat-CEL').innerHTML)
        cel_mod = parseInt(document.getElementById('stat-CEL-mod').innerHTML)
        cel_from_items = parseInt(document.getElementById('item-skill-cel').innerHTML)
        weight_mod = document.getElementById('weapon-weight-mod').innerHTML
        cel_mods = cel+cel_mod+cel_effect_bonus+cel_from_items-weight_mod

        dice_result = getDiceWMods(window_action,cel_mods,getResult=true,text=action)

        details = 'CEL'+'('+cel+')'+ ' + '+'MODS'+'('+(cel_mod+cel_effect_bonus+cel_from_items)+')'+' - WEAPON WEIGHT('+weight_mod+')'
        window_action.onclick = function() {change_result(details,window_action,cel_mods, dice_result)}
    }
    
    else if (action == 'Dodge')
    {
        dodge_effect_bonus = parseInt(document.getElementById('effects-dodge').innerHTML)
        zre = parseInt(document.getElementById('stat-ZRE').innerHTML)
        zre_mod = parseInt(document.getElementById('stat-ZRE-mod').innerHTML) 
        armor_mod = parseInt(document.getElementById('armor-mod').innerHTML) 
        zre_from_items = parseInt(document.getElementById('item-skill-zre').innerHTML)
        dodge_mods = zre+zre_mod+dodge_effect_bonus-armor_mod+zre_from_items

        window_action_additional.innerHTML = ''
        window_action_additional.onclick = ''

        dice_result = getDiceWMods(window_action,dodge_mods,getResult=true,text=action)

        details = 'ZRE'+'('+zre+')'+ ' + '+'MODS'+'('+(zre_mod+dodge_effect_bonus+zre_from_items)+')'+ ' + '+'ARMOR'+'('+(-armor_mod)+')'
        window_action.onclick = function() {change_result(details,window_action,dodge_mods, dice_result)}
    }

    else if (action == 'Attack')
    {
        attack_effect_bonus = parseInt(document.getElementById('effects-attack').innerHTML)
        sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
        sil_mod = parseInt(document.getElementById('stat-SIŁ-mod').innerHTML) 
        sil_from_items = parseInt(document.getElementById('item-skill-sil').innerHTML)


        if(document.getElementById('l_bonus').innerHTML != 'Empty')
        {
            leftWeapon = document.getElementById('l_weapon')
            l_type = leftWeapon.getAttribute('name')
            if(['Pistol','Musket','Crossbow','Bow'].includes(l_type)){
                sil=0
                sil_mod=0
            }
            l_bonus = parseInt(document.getElementById('l_bonus').innerHTML)

            if(leftWeapon.getAttribute("name") == 'shield')
            { //shield-left-hand-attack
                shield_attack_mods = sil+sil_mod-10+attack_effect_bonus+sil_from_items
                l_shield_dice_result = getDiceWMods(window_action_additional,shield_attack_mods,getResult=true,text='Left hand')
                l_shield_details = 'SIŁ'+'('+sil+')'+ ' + ' + 'MODS'+'('+sil_mod+sil_from_items+')'+' + '+'BONUS'+'('+l_bonus+')'+' + '+'BASIC(-10)'
                window_action_additional.onclick = function() {change_result(l_shield_details,window_action_additional,shield_attack_mods, l_shield_dice_result,additional=true)}
            }
            else
            { //normal-left-hand-attack
                leftWeaponDmg = parseInt(document.getElementById('l_dmg').innerHTML)
                leftWeaponAp = parseInt(document.getElementById('l_ap').innerHTML)
                l_mods = sil+sil_mod+leftWeaponDmg+l_bonus+attack_effect_bonus+sil_from_items
                l_normal_dice_result = getDiceWMods(window_action_additional,l_mods,getResult=true,text='Left hand')
                l_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+attack_effect_bonus+sil_from_items)+')'+' + '+'WEAPON'+'('+leftWeaponDmg+')'+' + '+'BONUS'+'('+l_bonus+')'+' ; '+'AP'+'('+leftWeaponAp+')'
                window_action_additional.onclick = function() {change_result(l_normal_details,window_action_additional,l_mods, l_normal_dice_result,additional=true)}
            }
        }
        else{window_action_additional.innerHTML = 'Left hand: Empty'}



        if(document.getElementById('r_bonus').innerHTML != 'Empty' && document.getElementById('r_bonus').innerHTML != '')
        {
            rightWeapon = document.getElementById('r_weapon')
            r_bonus = parseInt(document.getElementById('r_bonus').innerHTML)
            r_type = rightWeapon.getAttribute('name')
            if(['Pistol','Musket','Crossbow','Bow'].includes(r_type)){
                sil=0
                sil_mod=0
            }

            if(rightWeapon.getAttribute("name") == 'shield')
            { //shield-right-hand-attack
                shield_attack_mods = sil+sil_mod-10+attack_effect_bonus+sil_from_items
                r_shield_dice_result = getDiceWMods(window_action,shield_attack_mods,getResult=true,text='Right hand')
                r_shield_details = 'SIŁ'+'('+sil+')'+ ' + ' + 'MODS'+'('+sil_mod+sil_from_items+')'+' + '+'BONUS'+'('+r_bonus+')'+' + '+'BASIC(-10)'
                window_action.onclick = function() {change_result(r_shield_details,window_action,shield_attack_mods, r_shield_dice_result)}
            }
            else
            { //normal-right-hand-attack
                rightWeaponDmg = parseInt(document.getElementById('r_dmg').innerHTML)
                rightWeaponAp = parseInt(document.getElementById('r_ap').innerHTML)
                r_mods = sil+sil_mod+rightWeaponDmg+r_bonus+attack_effect_bonus+sil_from_items
                r_normal_dice_result = getDiceWMods(window_action,r_mods,getResult=true,text='Right hand')
                r_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+attack_effect_bonus+sil_from_items)+')'+' + '+'WEAPON'+'('+rightWeaponDmg+')'+' + '+'BONUS'+'('+r_bonus+')'+' ; '+'AP'+'('+rightWeaponAp+')'
                window_action.onclick = function() {change_result(r_normal_details,window_action,r_mods, r_normal_dice_result)}
            }  
        }
        else{window_action.innerHTML = 'Right hand: Empty'}
    }

    else if (action == 'Parry')
    {
        parry_effect_bonus = parseInt(document.getElementById('effects-parry').innerHTML)
        sil = parseInt(document.getElementById('stat-SIŁ').innerHTML)
        sil_mod = parseInt(document.getElementById('stat-SIŁ-mod').innerHTML) 
        sil_from_items = parseInt(document.getElementById('item-skill-sil').innerHTML)


        if(document.getElementById('l_bonus').innerHTML != 'Empty')
        {
            leftWeapon = document.getElementById('l_weapon')
            l_bonus = parseInt(document.getElementById('l_bonus').innerHTML)

            if(leftWeapon.getAttribute("name") == 'shield')
            { //shield-left-hand-attack
                l_block = parseInt(document.getElementById('l_block').innerHTML)
                l_shield_dice_result = getDiceWMods(window_action_additional,(l_block+l_bonus),getResult=true,text='Left hand', d0exception=true)
                l_shield_details = 'BLOCK'+'('+l_block+')'+ ' + ' + 'BONUS'+'('+l_bonus+')'
                window_action_additional.onclick = function() {change_result(l_shield_details,window_action_additional,(l_block+l_bonus), l_shield_dice_result,additional=true)}
            }
            else
            { //normal-left-hand-parry
                leftWeaponDmg = parseInt(document.getElementById('l_dmg').innerHTML)
                leftWeaponAp = parseInt(document.getElementById('l_ap').innerHTML)
                l_mods = sil+sil_mod+leftWeaponDmg+l_bonus+parry_effect_bonus+sil_from_items
                l_normal_dice_result = getDiceWMods(window_action_additional,l_mods,getResult=true,text='Left hand')
                l_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+parry_effect_bonus+sil_from_items)+')'+' + '+'WEAPON'+'('+leftWeaponDmg+')'+' + '+'BONUS'+'('+l_bonus+')'
                window_action_additional.onclick = function() {change_result(l_normal_details,window_action_additional,l_mods, l_normal_dice_result,additional=true)}
            }
        }
        else{window_action_additional.innerHTML = 'Left hand: Empty'}



        if(document.getElementById('r_bonus').innerHTML != 'Empty' && document.getElementById('r_bonus').innerHTML != '')
        {
            rightWeapon = document.getElementById('r_weapon')
            r_bonus = parseInt(document.getElementById('r_bonus').innerHTML)

            if(rightWeapon.getAttribute("name") == 'shield')
            { //shield-right-hand-attack
                r_block = parseInt(document.getElementById('r_block').innerHTML)
                r_shield_dice_result = getDiceWMods(window_action,(r_block+r_bonus),getResult=true,text='Right hand', d0exception=true)
                r_shield_details = 'BLOCK'+'('+r_block+')'+ ' + ' + 'BONUS'+'('+r_bonus+')'
                window_action.onclick = function() {change_result(r_shield_details,window_action,(r_block+r_bonus), r_shield_dice_result)}
            }
            else
            { //normal-right-hand-parry
                rightWeaponDmg = parseInt(document.getElementById('r_dmg').innerHTML)
                rightWeaponAp = parseInt(document.getElementById('r_ap').innerHTML)
                r_mods = sil+sil_mod+rightWeaponDmg+r_bonus+parry_effect_bonus+sil_from_items
                r_normal_dice_result = getDiceWMods(window_action,r_mods,getResult=true,text='Right hand')
                r_normal_details = 'SIŁ'+'('+sil+')'+ ' + '+'MODS'+'('+(sil_mod+parry_effect_bonus+sil_from_items)+')'+' + '+'WEAPON'+'('+rightWeaponDmg+')'+' + '+'BONUS'+'('+r_bonus+')'
                window_action.onclick = function() {change_result(r_normal_details,window_action,r_mods, r_normal_dice_result)}
            }
        }
        else{window_action.innerHTML = 'Right hand: Empty'}
    }
}

function getDiceWMods(instance,modsPoints,getResult=false,text='Result', d0exception=false){
    if (d0exception){
        dice = 0
    }
    else{
        dice = getRandomInt(1,21)
    }
    result = dice+modsPoints
    if(result < 1){
        result = 1
    }
    instance.innerHTML = text + ': ' + result + ' (Dice ' + dice + ')'
    if (getResult){
        return text + ': ' + result + ' (Dice ' + dice + ')'
    }
}
</script>

{% endfor %}
{% endblock content %}